config:
  inherit-env: true
  # Expects the tests to be ran from the root of project
  dir: e2e

tests:
  create root:
    command: ./worklog create
    stdout:
      line-count: 0
    stderr:
      line-count: 17
      lines:
        1: "Error: required flag(s) \"title\" not set"
    exit-code: 1

  create minimal:
    command: ./worklog create --repo "bolt" --repoPath "/tmp/e2e.db" --title "foo"
    stdout:
      line-count: 2
      lines:
        1: "Saving file..."
        2: "Saved file"
    exit-code: 0

  create all:
    command: ./worklog create --repo "bolt" --repoPath "/tmp/e2e.db" --title "foo" --description "bar" --tags "bang, pop" --when "$(date '+%Y-%m-%d %H:%M')" --duration 10
    stdout:
      line-count: 2
      lines:
        1: "Saving file..."
        2: "Saved file"
    exit-code: 0

  create with html:
    command: ./worklog create --repo "bolt" --repoPath "/tmp/e2e.db" --title "<a href="">foo<a>" && ./worklog print --repo "bolt" --repoPath "/tmp/e2e.db" -jt | jq -r '. | last | .title'
    stdout:
      line-count: 3
      lines:
        1: "Saving file..."
        2: "Saved file"
        3: "foo"
    exit-code: 0

  create date:
    command: ./worklog create --repo "bolt" --repoPath "/tmp/e2e.db" --title "foo" --when "$(date -d 'last Sunday - 1 day' '+%Y-%m-%d')"
    stdout:
      line-count: 2
      lines:
        1: "Saving file..."
        2: "Saved file"
    exit-code: 0

  create with xss capable html:
    command: ./worklog create --repo "bolt" --repoPath "/tmp/e2e.db" --title "<a href=\"javascript:alert('XSS1')\" onmouseover=\"alert('XSS2')\">bar<a>" --when "$(date -d 'last Sunday - 2 day' '+%Y-%m-%d')" && ./worklog print --repo "bolt" --repoPath "/tmp/e2e.db" -j --startDate "$(date -d 'last Sunday - 2 day' '+%Y-%m-%d')" --endDate "$(date -d 'last Sunday - 2 day' '+%Y-%m-%d')" | jq -r '. | last | .title'
    stdout:
      line-count: 3
      lines:
        1: "Saving file..."
        2: "Saved file"
        3: "bar"
    exit-code: 0
